package com.bume.core.login;import com.bume.core.exceptions.ValidacaoException;import com.bume.core.login.model.LoginArgs;import com.bume.core.login.model.LoginInfo;import com.bume.core.security.PasswordUtil;import com.bume.core.security.jwt.TokenUtils;import com.bume.core.security.service.Logado;import com.bume.core.security.service.SecurityService;import com.bume.core.usuario.Usuario;import com.bume.core.usuario.UsuarioService;import com.bume.core.usuario.dto.UsuarioDto;import com.bume.core.util.StringUtil;import javax.enterprise.context.ApplicationScoped;import javax.inject.Inject;import javax.transaction.Transactional;import java.util.UUID;@ApplicationScopedpublic class LoginService {    @Inject    Logado logado;    @Inject    UsuarioService usuarioService;    @Transactional    public LoginInfo autenticar(LoginArgs loginInfo) throws Exception {        if (StringUtil.isEmpty(loginInfo.getLogin()) || StringUtil.isEmpty(loginInfo.getSenha())) {            throw ValidacaoException.builder().status(401).mensagem("Usuário ou senha incorretos.").build();        }        var usuario = Usuario.findByLoginAndAtivo(loginInfo.getLogin());        LoginInfo result = new LoginInfo();        if (usuario != null && PasswordUtil.verifyPassword(loginInfo.getSenha(), usuario.getSenha())) {            result.setUsuario(new UsuarioDto(usuario));            //result.setToken(TokenUtils.generateToken());            result.setToken(UUID.randomUUID().toString());            logado.setToken(SecurityService.addToken(usuario, result.getToken()));            return result;        }        throw ValidacaoException.builder().status(401).mensagem("Usuário ou senha incorretos.").build();    }}